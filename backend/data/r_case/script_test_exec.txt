library(tidyr)
library(dplyr)

p34_input1 = read.csv("r34_input1.csv")
if (is.data.frame(p34_input1) | is.matrix(p34_input1)) {
        write(paste(append(colnames(p34_input1), 4, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(p34_input1, file="table4.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(p34_input1)) {
            write(paste(append(group_vars(p34_input1), "group4", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
p34_input2 = read.csv("r34_input2.csv")
if (is.data.frame(p34_input2) | is.matrix(p34_input2)) {
        write(paste(append(colnames(p34_input2), 5, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(p34_input2, file="table5.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(p34_input2)) {
            write(paste(append(group_vars(p34_input2), "group5", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
# TBL_3=inner_join(p34_input2, p34_input1, by="mult")
TBL_3=inner_join(p34_input2, p34_input1)
if (is.data.frame(TBL_3) | is.matrix(TBL_3)) {
        write(paste(append(colnames(TBL_3), 7, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(TBL_3, file="table7.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(TBL_3)) {
            write(paste(append(group_vars(TBL_3), "group7", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
TBL_1=mutate(TBL_3,total=value / size)
if (is.data.frame(TBL_1) | is.matrix(TBL_1)) {
        write(paste(append(colnames(TBL_1), 8, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(TBL_1, file="table8.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(TBL_1)) {
            write(paste(append(group_vars(TBL_1), "group8", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
morpheus=select(TBL_1,-`value`)
if (is.data.frame(morpheus) | is.matrix(morpheus)) {
        write(paste(append(colnames(morpheus), 9, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(morpheus, file="table9.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(morpheus)) {
            write(paste(append(group_vars(morpheus), "group9", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
morpheus=as.data.frame(morpheus)
if (is.data.frame(morpheus) | is.matrix(morpheus)) {
        write(paste(append(colnames(morpheus), 10, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(morpheus, file="table10.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(morpheus)) {
            write(paste(append(group_vars(morpheus), "group10", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
morpheus=select(morpheus,2,1,3)
if (is.data.frame(morpheus) | is.matrix(morpheus)) {
        write(paste(append(colnames(morpheus), 11, after = 0), collapse=','), "colnames.txt", append=T)
        write.table(morpheus, file="table11.csv", sep=",", quote=FALSE, append=FALSE, na="NA", row.names=FALSE)
        if (is.grouped_df(morpheus)) {
            write(paste(append(group_vars(morpheus), "group11", after = 0), collapse=','), "colnames.txt", append=T)
        }
    }
# write.csv(morpheus, "r34_output1.csv", row.names=F)
